<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendar Serviço</title>
<style>
    body { font-family: Arial; background:#f5f5f5; padding:20px; }
    .card { background:white; padding:25px; border-radius:10px; max-width:450px; margin:auto; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    button { padding:10px 15px; border:none; background:#2563eb; color:white; border-radius:6px; cursor:pointer; }
    #horarios button { width:100%; margin-top:10px; background:#4b5563; }
</style>
</head>
<body>

<div class="card">
    <h2>Agendar Serviço</h2>

    <label>Data:</label>
    <input type="date" id="data" />

    <button onclick="carregarHorarios()" id="btnCarregar">Selecionar Horário</button>

    <div id="horarios"></div>
</div>

<script>
    // -----------------------------
    // GARANTE QUE O id_servico EXISTE
    // -----------------------------
    const urlParams = new URLSearchParams(window.location.search);
    const idServico = urlParams.get("id");

    if (!idServico) {
        alert("ERRO: Nenhum serviço selecionado.");
        throw new Error("id_servico ausente");
    }

    async function carregarHorarios() {
        const data = document.getElementById("data").value;
        const btn = document.getElementById("btnCarregar");

        if (!data) {
            alert("Selecione uma data.");
            return;
        }

        btn.innerText = "Carregando horários...";

        try {
            const resposta = await fetch(`http://localhost:3000/agendamento/horarios/${idServico}?data=${data}`);

            if (!resposta.ok) {
                throw new Error("Erro ao buscar horários");
            }

            const horarios = await resposta.json();
            const divHorarios = document.getElementById("horarios");
            divHorarios.innerHTML = "";

            if (horarios.length === 0) {
                divHorarios.innerHTML = "<p>Nenhum horário disponível.</p>";
                btn.innerText = "Selecionar horário";
                return;
            }

            horarios.forEach(h => {
                const b = document.createElement("button");
                b.textContent = h;
                b.onclick = () => selecionarHorario(h);
                divHorarios.appendChild(b);
            });

        } catch (erro) {
            console.error("Erro:", erro);
            alert("Não foi possível carregar os horários.");
        }

        btn.innerText = "Selecionar horário";
    }

    function selecionarHorario(horario) {
        alert("Horário selecionado: " + horario);
        // aqui você depois envia para o backend fazer o agendamento
    }
</script>

</body>
</html>


