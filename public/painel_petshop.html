<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel - Gerenciar Produtos</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f0f2f5;
    }

    header {
        background: #2563eb;
        color: white;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    h1 { margin: 0; }

    .btn-sair {
        background: #ef4444;
        border: none;
        padding: 10px 18px;
        border-radius: 8px;
        cursor: pointer;
        color: white;
        font-size: 15px;
    }
    .btn-sair:hover { background: #dc2626; }

    .container {
        width: 90%;
        margin: 20px auto;
    }

    .btn-add {
        display: inline-block;
        padding: 12px 18px;
        background: #10b981;
        color: white;
        border-radius: 8px;
        text-decoration: none;
        margin-bottom: 20px;
        font-weight: bold;
    }
    .btn-add:hover { background: #059669; }

    .produtos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 20px;
    }

    .card {
        background: white;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        text-align: center;
    }

    .card img {
        width: 100%;
        height: 160px;
        object-fit: cover;
        border-radius: 10px;
    }

    .card h3 { margin: 10px 0; color: #333; }
    .card p { font-size: 14px; color: #555; }
    .card strong { display: block; margin-top: 10px; font-size: 18px; color: #2563eb; }

    .actions {
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
    }

    .btn-edit {
        background: #3b82f6;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        text-decoration: none;
        cursor: pointer;
    }
    .btn-edit:hover { background: #1d4ed8; }

    .btn-delete {
        background: #ef4444;
        border: none;
        padding: 8px 12px;
        color: white;
        border-radius: 6px;
        cursor: pointer;
    }
    .btn-delete:hover { background: #b91c1c; }

    /* -------- MODAL -------- */
    #modal-editar {
        display:none;
        position: fixed;
        top:0; left:0;
        width:100%; height:100%;
        background: rgba(0,0,0,0.5);
        justify-content:center;
        align-items:center;
    }

    #modal-box {
        background:white;
        padding:20px;
        width:380px;
        border-radius:12px;
    }

    #modal-box input,
    #modal-box textarea,
    #modal-box select {
        width:100%;
        padding:10px;
        margin-top:5px;
        border:1px solid #ddd;
        border-radius:8px;
        font-size: 15px;
    }

    /* Select estilizado */
    #modal-box select {
        appearance: none;
        background-image: url("data:image/svg+xml;utf8,<svg fill='gray' height='22' width='22' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
        background-repeat: no-repeat;
        background-position: right 12px center;
        cursor: pointer;
    }

    #modal-box select:hover {
        border-color: #2563eb;
    }

    #modal-box select:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.25);
    }

    #modal-box button {
        width:100%;
        padding:12px;
        border:none;
        border-radius:8px;
        margin-top:10px;
        cursor:pointer;
        font-size:15px;
    }

    .btn-save { background:#2563eb; color:white; }
    .btn-cancel { background:#ef4444; color:white; }

</style>
</head>
<body>

<header>
    <h1>Gerenciar Produtos</h1>
    <a href="dashboard_petshop.html">
        <button class="btn-sair">Voltar</button>
    </a>
</header>

<div class="container">
    <a href="cadastro_produto.html" class="btn-add">+ Adicionar Produto</a>

    <div id="produtos" class="produtos-grid"></div>
</div>

<!-- üîµ MODAL DE EDI√á√ÉO -->
<div id="modal-editar">
    <div id="modal-box">
        <h2>Editar Produto</h2>

        <label>Nome</label>
        <input id="edit-nome">

        <label>Pre√ßo</label>
        <input id="edit-preco" type="number" step="0.01">

        <label>Descri√ß√£o</label>
        <textarea id="edit-descricao"></textarea>

        <label>Status do Produto</label>
        <select id="edit-ativo">
            <option value="true">Ativo</option>
            <option value="false">Inativo</option>
        </select>

        <label>Imagem</label>
        <input id="edit-imagem" type="file">

        <button class="btn-save" onclick="salvarEdicao()">Salvar</button>
        <button class="btn-cancel" onclick="fecharModal()">Cancelar</button>
    </div>
</div>

<script>
const token = localStorage.getItem("token_petshop");
if (!token) window.location.href = "login_petshop.html";

let produtoAtual = null;

// üîÑ Carregar produtos
async function carregarProdutos() {
    const resposta = await fetch("http://localhost:3000/produto/meus", {
        headers: { "Authorization": "Bearer " + token }
    });

    const dados = await resposta.json();
    const container = document.getElementById("produtos");
    container.innerHTML = "";

    dados.forEach(p => {
        container.innerHTML += `
            <div class="card">
                <img src="${p.imagem_url || 'img/sem-imagem.png'}">
                <h3>${p.nome}</h3>
                <p>${p.descricao}</p>
                <strong>R$ ${p.preco}</strong>

                <span style="
                    margin-top: 5px;
                    display: inline-block;
                    padding: 4px 8px;
                    border-radius: 6px;
                    font-weight: bold;
                    font-size: 13px;
                    color: white;
                    background: ${p.ativo ? '#28a745' : '#dc3545'};
                ">
                    ${p.ativo ? 'Ativo' : 'Inativo'}
                </span>

                <div class="actions">
                    <button class="btn-edit" onclick="editar(${p.id_produto})">Editar</button>
                    <button class="btn-delete" onclick="excluir(${p.id_produto})">Excluir</button>
                </div>
            </div>
        `;
    });
}

carregarProdutos();

// üîµ Abrir modal
async function editar(id) {
    const resp = await fetch(`http://localhost:3000/produto/${id}`, {
        headers: { "Authorization": "Bearer " + token }
    });

    const produto = await resp.json();
    produtoAtual = produto;

    document.getElementById("edit-nome").value = produto.nome;
    document.getElementById("edit-preco").value = produto.preco;
    document.getElementById("edit-descricao").value = produto.descricao;
    document.getElementById("edit-ativo").value = produto.ativo ? "true" : "false";

    document.getElementById("modal-editar").style.display = "flex";
}

// üî¥ Fechar modal
function fecharModal() {
    document.getElementById("modal-editar").style.display = "none";
}

// ‚úî Salvar edi√ß√£o
async function salvarEdicao() {
    const formData = new FormData();
    formData.append("nome", document.getElementById("edit-nome").value);
    formData.append("preco", document.getElementById("edit-preco").value);
    formData.append("descricao", document.getElementById("edit-descricao").value);
    formData.append("ativo", document.getElementById("edit-ativo").value);

    const img = document.getElementById("edit-imagem").files[0];
    if (img) formData.append("imagem", img);

    const resp = await fetch(`http://localhost:3000/produto/${produtoAtual.id_produto}`, {
        method: "PUT",
        headers: { "Authorization": "Bearer " + token },
        body: formData
    });

    if (!resp.ok) {
        alert("Erro ao atualizar produto!");
        return;
    }

    alert("Produto atualizado com sucesso!");
    fecharModal();
    carregarProdutos();
}

// üóëÔ∏è Excluir
async function excluir(id) {
    if (!confirm("Excluir este produto?")) return;

    const resp = await fetch(`http://localhost:3000/produto/${id}`, {
        method: "DELETE",
        headers: { "Authorization": "Bearer " + token }
    });

    if (resp.ok) {
        alert("Produto exclu√≠do");
        carregarProdutos();
    } else {
        alert("Erro ao excluir");
    }
}

// Logout
document.getElementById("logout").onclick = () => {
    localStorage.removeItem("token_petshop");
    window.location.href = "login_petshop.html";
};
</script>

</body>
</html>
