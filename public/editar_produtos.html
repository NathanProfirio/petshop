<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Editar Produto</title>
    <link rel="stylesheet" href="css/Editar.css">
</head>
<body>

<div class="container">
    <h1>Editar Produto</h1>

    <form id="formEditar">
        <label>Nome do Produto</label>
        <input type="text" id="nome" required>

        <label>Descrição</label>
        <textarea id="descricao" required></textarea>

        <label>Preço</label>
        <input type="number" id="preco" step="0.01" required>

        <label>URL da Imagem</label>
        <input type="text" id="imagem_url">

        <button type="submit" class="btn">Salvar Alterações</button>
        <a href="produtos.html" class="btn-voltar">Voltar</a>
    </form>
</div>

<script>
const id = new URLSearchParams(window.location.search).get("id");

// 1️⃣ Carregar dados do produto para edição
async function carregarProduto() {
    const resposta = await fetch(`http://localhost:3000/produto/${id}`);
    const produto = await resposta.json();

    document.getElementById("nome").value = produto.nome;
    document.getElementById("descricao").value = produto.descricao;
    document.getElementById("preco").value = produto.preco;
    document.getElementById("imagem_url").value = produto.imagem_url || "";
}

carregarProduto();


// 2️⃣ Atualizar o produto
document.getElementById("formEditar").addEventListener("submit", async (e) => {
    e.preventDefault();

    const dados = {
        nome: document.getElementById("nome").value,
        descricao: document.getElementById("descricao").value,
        preco: document.getElementById("preco").value,
        imagem_url: document.getElementById("imagem_url").value
    };

    const token = localStorage.getItem("token");

    const resposta = await fetch(`http://localhost:3000/produto/${id}`, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify(dados)
    });

    if (resposta.ok) {
        alert("Produto atualizado com sucesso!");
        window.location.href = "produtos.html";
    } else {
        alert("Erro ao atualizar o produto");
    }
});
</script>

</body>
</html>
